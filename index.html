<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Lacto Dodge ‚Äî mini game</title>
<style>
  :root{
    --bg:#0b1220;
    --stroke:rgba(255,255,255,.14);
    --text:rgba(255,255,255,.92);
    --muted:rgba(255,255,255,.65);
    --good:#42f59e;
    --bad:#ff5b6e;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background: radial-gradient(900px 500px at 20% 0%, rgba(122,167,255,.18), transparent 60%),
                radial-gradient(700px 450px at 90% 20%, rgba(154,123,255,.16), transparent 55%),
                var(--bg);
    color:var(--text);
    height:100vh;
    overflow:hidden;
  }
  .wrap{
    width:min(520px, 100%);
    height:100vh;
    margin:0 auto;
    padding:12px 12px 14px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  header{
    border:1px solid var(--stroke);
    border-radius:16px;
    padding:10px 12px;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    position:relative;
    overflow:hidden;
  }
  .top{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:10px;
  }
  h1{
    margin:0;
    font-size:14px;
    letter-spacing:.2px;
  }
  .pill{
    font-size:11px;
    padding:4px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.18);
    background:rgba(255,255,255,.05);
    color:rgba(255,255,255,.70);
    white-space:nowrap;
  }
  .hint{
    margin:6px 0 0;
    font-size:12px;
    color:var(--muted);
    line-height:1.35;
  }
  button{
    border:1px solid var(--stroke);
    background:rgba(255,255,255,.06);
    color:var(--text);
    padding:9px 12px;
    border-radius:999px;
    font-weight:700;
    cursor:pointer;
  }
  button:active{ transform: translateY(1px); }
  button.primary{
    border-color: rgba(122,167,255,.45);
    background: rgba(122,167,255,.14);
  }

  /* TOP SHEET (Game Over / How-to) */
  .topSheet{
    margin-top:10px;
    border:1px solid rgba(255,255,255,.16);
    border-radius:16px;
    background: linear-gradient(180deg, rgba(17,26,47,.98), rgba(12,18,32,.98));
    box-shadow: 0 24px 70px rgba(0,0,0,.45);
    padding:12px;
    display:none;
  }
  .topSheet.show{ display:block; }
  .sheetRow{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:10px;
  }
  .topSheet h2{
    margin:0;
    font-size:14px;
    letter-spacing:.2px;
  }
  .topSheet p{
    margin:8px 0 0;
    font-size:12.5px;
    color:rgba(255,255,255,.82);
    line-height:1.45;
  }
  .sheetActions{
    display:flex;
    gap:8px;
    align-items:center;
    flex-wrap:wrap;
    margin-top:10px;
  }

  .hud{
    display:grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap:8px;
  }
  .card{
    border:1px solid var(--stroke);
    border-radius:14px;
    padding:10px;
    background:rgba(255,255,255,.04);
  }
  .label{font-size:11px;color:var(--muted);display:flex;justify-content:space-between;gap:8px}
  .val{font-size:16px;font-weight:850;margin-top:4px}
  .bar{height:8px;border-radius:999px;background:rgba(255,255,255,.10);overflow:hidden;margin-top:8px}
  .bar > i{display:block;height:100%;width:50%;background:linear-gradient(90deg, rgba(66,245,158,.9), rgba(122,167,255,.8))}
  .bar.bad > i{background:linear-gradient(90deg, rgba(255,91,110,.95), rgba(255,204,102,.65))}

  .game{
    position:relative;
    isolation:isolate;
    flex:1;
    border:1px solid var(--stroke);
    border-radius:20px;
    overflow:hidden;
    background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.12));
    touch-action: manipulation;
  }
  .game.dimmed::after{
    content:"";
    position:absolute; inset:0;
    background: rgba(0,0,0,.45);
    backdrop-filter: blur(3px);
    z-index: 2000;
    pointer-events:none;
  }

  .fog{
    position:absolute; inset:0;
    pointer-events:none;
    background: rgba(120, 70, 25, 0.0);
    transition: background .15s linear;
    z-index: 1;
  }
  .ground{
    position:absolute;
    left:0; right:0; bottom:0;
    height:32%;
    background: linear-gradient(180deg, rgba(255,255,255,.00), rgba(0,0,0,.20));
    z-index: 2;
  }

  .eater{
    position:absolute;
    left:50%;
    bottom:6%;
    transform:translateX(-50%);
    width:220px;
    height:120px;
    pointer-events:none;
    opacity:.95;
    z-index: 5;
  }
  .table{
    position:absolute;
    left:50%;
    bottom:0;
    transform:translateX(-50%);
    width:300px;
    height:54px;
    border-radius:18px;
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.14);
    box-shadow: 0 14px 40px rgba(0,0,0,.25);
  }
  .person{
    position:absolute;
    left:50%;
    bottom:30px;
    transform:translateX(-50%);
    width:74px; height:74px;
    border-radius:22px;
    background:rgba(255,255,255,.10);
    border:1px solid rgba(255,255,255,.18);
    display:flex; align-items:center; justify-content:center;
    font-size:34px;
  }
  .caption{
    position:absolute;
    left:50%;
    bottom:92px;
    transform:translateX(-50%);
    font-size:12px;
    color:rgba(255,255,255,.72);
    background:rgba(0,0,0,.25);
    border:1px solid rgba(255,255,255,.12);
    padding:6px 10px;
    border-radius:999px;
  }

  .food{
    position:absolute;
    padding:10px 12px;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.16);
    background:rgba(255,255,255,.06);
    backdrop-filter: blur(4px);
    box-shadow: 0 14px 40px rgba(0,0,0,.22);
    font-size:18px;
    user-select:none;
    -webkit-user-select:none;
    z-index: 10;
  }
  .food .name{
    font-size:11px;
    margin-top:3px;
    color:rgba(255,255,255,.68);
    text-align:center;
    max-width:90px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .food.lacto{
    border-color: rgba(255,91,110,.35);
    background: rgba(255,91,110,.10);
  }
  .food.safe{
    border-color: rgba(66,245,158,.30);
    background: rgba(66,245,158,.08);
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="top">
        <div>
          <h1>Lacto Dodge <span class="pill">tap to block lactose</span></h1>
          <div class="hint">
            Tap lactose foods to block them. Let safe foods land for points.
            Too much lactose ‚Üí smell rises ‚Üí oxygen drops ‚Üí brown fog‚Ä¶ game over.
          </div>
        </div>
        <button id="btnStart">Start</button>
      </div>

      <!-- TOP SHEET (shows instructions / game over) -->
      <div class="topSheet show" id="sheet">
        <div class="sheetRow">
          <div>
            <h2 id="sheetTitle">How to play</h2>
            <p id="sheetText">
              ‚úÖ Safe foods: let them land (+score).<br>
              ‚ùå Lactose foods: tap them to block. If they land: smell ‚Üë and oxygen ‚Üì.<br><br>
              Warm-up: first <b>10</b> seconds are slower to feel fair.
            </p>
          </div>
          <div class="pill" id="sheetTag">READY</div>
        </div>
        <div class="sheetActions">
          <button class="primary" id="btnPlay" style="flex:1">Play</button>
          <button id="btnCloseSheet" style="display:none">Close</button>
        </div>
      </div>
    </header>

    <div class="hud">
      <div class="card">
        <div class="label"><span>Score</span><span id="scoreTxt">0</span></div>
        <div class="val" id="scoreBig">0</div>
      </div>
      <div class="card">
        <div class="label"><span>Smell</span><span id="smellTxt">0%</span></div>
        <div class="bar bad" id="smellBar"><i></i></div>
      </div>
      <div class="card">
        <div class="label"><span>Oxygen</span><span id="oxyTxt">100%</span></div>
        <div class="bar" id="oxyBar"><i></i></div>
      </div>
    </div>

    <div class="game dimmed" id="game">
      <div class="fog" id="fog"></div>
      <div class="ground"></div>
      <div class="eater">
        <div class="caption" id="mood">Feeling fine üôÇ</div>
        <div class="person">üßë‚ÄçüçΩÔ∏è</div>
        <div class="table"></div>
      </div>
    </div>
  </div>

<script>
(() => {
  const game = document.getElementById("game");

  const btnStart = document.getElementById("btnStart");
  const btnPlay = document.getElementById("btnPlay");
  const btnCloseSheet = document.getElementById("btnCloseSheet");

  const sheet = document.getElementById("sheet");
  const sheetTitle = document.getElementById("sheetTitle");
  const sheetText = document.getElementById("sheetText");
  const sheetTag = document.getElementById("sheetTag");

  const scoreTxt = document.getElementById("scoreTxt");
  const scoreBig = document.getElementById("scoreBig");
  const smellTxt = document.getElementById("smellTxt");
  const oxyTxt = document.getElementById("oxyTxt");
  const smellBar = document.getElementById("smellBar").querySelector("i");
  const oxyBar = document.getElementById("oxyBar").querySelector("i");
  const fog = document.getElementById("fog");
  const mood = document.getElementById("mood");

  const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));
  const rnd = (a,b)=>Math.random()*(b-a)+a;
  const pick = (arr)=>arr[(Math.random()*arr.length)|0];

  const FOODS = [
    // lactose (avoid)
    {name:"Milk", icon:"ü•õ", lactose:true},
    {name:"Cheese", icon:"üßÄ", lactose:true},
    {name:"Ice cream", icon:"üç¶", lactose:true},
    {name:"Yogurt", icon:"ü•£", lactose:true},
    {name:"Cream", icon:"ü•õ", lactose:true},
    {name:"Latte", icon:"‚òïÔ∏è", lactose:true},
    {name:"Milk chocolate", icon:"üç´", lactose:true},
    {name:"Butter", icon:"üßà", lactose:true},
    {name:"Cheesecake", icon:"üç∞", lactose:true},
    {name:"Pizza (cheese)", icon:"üçï", lactose:true},
    {name:"Milkshake", icon:"ü•§", lactose:true},
    {name:"Pudding", icon:"üçÆ", lactose:true},
    // safe
    {name:"Banana", icon:"üçå", lactose:false},
    {name:"Apple", icon:"üçé", lactose:false},
    {name:"Avocado", icon:"ü•ë", lactose:false},
    {name:"Rice", icon:"üçö", lactose:false},
    {name:"Egg", icon:"ü•ö", lactose:false},
    {name:"Chicken", icon:"üçó", lactose:false},
    {name:"Fish", icon:"üêü", lactose:false},
    {name:"Salad", icon:"ü•ó", lactose:false},
    {name:"Berries", icon:"ü´ê", lactose:false},
    {name:"Nuts", icon:"ü•ú", lactose:false},
    {name:"Tofu", icon:"üç±", lactose:false},
    {name:"Beans", icon:"ü´ò", lactose:false},
    {name:"Dark chocolate", icon:"üç´", lactose:false},
    {name:"Olive oil", icon:"ü´í", lactose:false},
  ];

  let running = false;
  let score = 0;
  let smell = 0;
  let oxygen = 100;
  let tPrev = 0;

  let spawnTimer = 0;
  let spawnInterval = 1500; // slower start
  let fallSpeed = 60;       // slower start
  let elapsed = 0;
  const WARMUP_SECONDS = 10;

  const items = new Set();

  function setSheet(mode, data={}){
    sheet.classList.add("show");

    if(mode === "howto"){
      sheetTitle.textContent = "How to play";
      sheetTag.textContent = "READY";
      sheetText.innerHTML =
        `‚úÖ Safe foods: let them land (+score).<br>
         ‚ùå Lactose foods: tap them to block. If they land: smell ‚Üë and oxygen ‚Üì.<br><br>
         Warm-up: first <b>${WARMUP_SECONDS}</b> seconds are slower to feel fair.`;
      btnPlay.textContent = "Play";
      btnCloseSheet.style.display = "none";
      btnPlay.style.display = "inline-flex";
      game.classList.add("dimmed");
      game.style.pointerEvents = "none";
    }

    if(mode === "gameover"){
      sheetTitle.textContent = "Game over";
      sheetTag.textContent = "NOT BREATHABLE";
      sheetText.innerHTML =
        `Final score: <b>${data.score}</b><br>
         Smell: <b>${data.smell}%</b> ¬∑ Oxygen: <b>${data.oxygen}%</b><br><br>
         Tip: tap lactose foods early ‚Äî and don‚Äôt waste taps on safe foods.`;
      btnPlay.textContent = "Play again";
      btnCloseSheet.style.display = "inline-flex";
      btnPlay.style.display = "inline-flex";
      game.classList.add("dimmed");
      game.style.pointerEvents = "none";
    }

    if(mode === "hidden"){
      sheet.classList.remove("show");
      game.classList.remove("dimmed");
      game.style.pointerEvents = "auto";
    }
  }

  function reset(){
    for (const it of items) it.el.remove();
    items.clear();

    score = 0; smell = 0; oxygen = 100;
    spawnTimer = 0;
    spawnInterval = 1500;
    fallSpeed = 60;
    elapsed = 0;

    tPrev = performance.now();
    updateHUD();
    setMood();
    setFog();
  }

  function updateHUD(){
    scoreTxt.textContent = score;
    scoreBig.textContent = score;
    smellTxt.textContent = `${Math.round(smell)}%`;
    oxyTxt.textContent = `${Math.round(oxygen)}%`;
    smellBar.style.width = `${clamp(smell,0,100)}%`;
    oxyBar.style.width = `${clamp(oxygen,0,100)}%`;
  }

  function setFog(){
    const a = clamp(smell/100, 0, 1);
    fog.style.background = `rgba(120, 70, 25, ${0.05 + a*0.55})`;
  }

  function setMood(){
    if(oxygen <= 0){ mood.textContent = "‚Ä¶üíÄ"; return; }
    if(smell < 20) mood.textContent = "Feeling fine üôÇ";
    else if(smell < 45) mood.textContent = "Uh-oh üòê";
    else if(smell < 70) mood.textContent = "Not great üòµ‚Äçüí´";
    else mood.textContent = "Evacuate! ü§¢";
  }

  function spawnFood(){
    const rect = game.getBoundingClientRect();
    const f = pick(FOODS);

    const el = document.createElement("div");
    el.className = "food " + (f.lactose ? "lacto" : "safe");
    el.innerHTML = `<div style="text-align:center">${f.icon}</div><div class="name">${f.name}</div>`;

    const maxX = rect.width - 110;
    const x = clamp(rnd(10, maxX), 8, maxX);
    const y = -60;
    el.style.left = x + "px";
    el.style.top = y + "px";

    const item = { el, x, y, lactose: f.lactose, hit:false };
    items.add(item);

    el.addEventListener("pointerdown", (e) => {
      e.preventDefault();
      if(!running) return;

      if(item.lactose) score += 1;
      else score = Math.max(0, score - 2);

      updateHUD();
      destroyItem(item);
    }, {passive:false});

    game.appendChild(el);
  }

  function destroyItem(item){
    if(!items.has(item)) return;
    items.delete(item);
    item.el.remove();
  }

  function onLand(item){
    if(item.hit) return;
    item.hit = true;

    if(item.lactose){
      smell = clamp(smell + rnd(10, 16), 0, 100);
      oxygen = clamp(oxygen - rnd(10, 14), 0, 100);
      score = Math.max(0, score - 1);
    } else {
      score += 3;
      oxygen = clamp(oxygen + 1.5, 0, 100);
      smell = clamp(smell - 1.0, 0, 100);
    }

    updateHUD();
    setFog();
    setMood();

    setTimeout(()=>destroyItem(item), 120);
  }

  function loop(now){
    if(!running) return;
    const dt = Math.min(0.033, (now - tPrev) / 1000);
    tPrev = now;
    elapsed += dt;

    if(elapsed < WARMUP_SECONDS){
      spawnInterval = Math.max(900, spawnInterval - dt*18);
      fallSpeed = Math.min(120, fallSpeed + dt*5);
    } else {
      spawnInterval = Math.max(420, spawnInterval - dt*30);
      fallSpeed = Math.min(280, fallSpeed + dt*9);
    }

    spawnTimer += dt*1000;
    if(spawnTimer >= spawnInterval){
      spawnTimer = 0;
      spawnFood();
      if(elapsed >= WARMUP_SECONDS && spawnInterval < 520 && Math.random() < 0.16) spawnFood();
    }

    const rect = game.getBoundingClientRect();
    const landY = rect.height * 0.72;

    for(const item of Array.from(items)){
      item.y += fallSpeed * dt;
      item.el.style.top = item.y + "px";

      if(item.y >= landY) onLand(item);
      else if(item.y > rect.height + 120) destroyItem(item);
    }

    if(smell > 50){
      oxygen = clamp(oxygen - dt*(smell/18), 0, 100);
      updateHUD();
    }
    setFog();

    if(oxygen <= 0 || smell >= 100){
      gameOver();
      return;
    }

    requestAnimationFrame(loop);
  }

  function gameOver(){
    running = false;

    // clear remaining foods
    for(const it of items) it.el.remove();
    items.clear();

    setSheet("gameover", {
      score,
      smell: Math.round(smell),
      oxygen: Math.round(oxygen)
    });
  }

  function start(){
    reset();
    setSheet("hidden");
    running = true;
    tPrev = performance.now();
    requestAnimationFrame(loop);
  }

  // UI events
  btnStart.addEventListener("click", () => setSheet("howto"));
  btnPlay.addEventListener("click", start);
  btnCloseSheet.addEventListener("click", () => setSheet("howto"));

  // initial state
  setSheet("howto");

  // prevent scroll inside game
  game.addEventListener("touchmove", (e)=>e.preventDefault(), {passive:false});
})();
</script>
</body>
</html>
